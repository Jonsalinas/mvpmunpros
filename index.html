<!DOCTYPE html>
<html lang="es">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Cliente Faster-Whisper Avanzado</title>
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
Â  Â  Â  max-width: 700px;
Â  Â  Â  margin: 50px auto;
Â  Â  Â  padding: 20px;
Â  Â  Â  background: #f5f5f5;
Â  Â  }
Â  Â  .container {
Â  Â  Â  background: white;
Â  Â  Â  padding: 30px;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
Â  Â  }
Â  Â  h1 {
Â  Â  Â  color: #333;
Â  Â  Â  text-align: center;
Â  Â  }
Â  Â  .form-group {
Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â  label {
Â  Â  Â  display: block;
Â  Â  Â  margin-bottom: 8px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: #555;
Â  Â  }
Â  Â  select, input[type="file"] {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 10px;
Â  Â  Â  border: 2px solid #ddd;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  font-size: 14px;
Â  Â  Â  transition: border-color 0.3s;
Â  Â  }
Â  Â  select:focus, input[type="file"]:focus {
Â  Â  Â  outline: none;
Â  Â  Â  border-color: #007bff;
Â  Â  }
Â  Â  button {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 12px 20px;
Â  Â  Â  background: #007bff;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-size: 16px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  transition: background 0.3s;
Â  Â  }
Â  Â  button:hover {
Â  Â  Â  background: #0056b3;
Â  Â  }
Â  Â  button:disabled {
Â  Â  Â  background: #ccc;
Â  Â  Â  cursor: not-allowed;
Â  Â  }
Â  Â  #resultado {
Â  Â  Â  margin-top: 20px;
Â  Â  Â  padding: 20px;
Â  Â  Â  background: #f8f9fa;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  white-space: pre-wrap;
Â  Â  Â  max-height: 400px;
Â  Â  Â  overflow-y: auto;
Â  Â  Â  display: none;
Â  Â  }
Â  Â  #resultado.show {
Â  Â  Â  display: block;
Â  Â  }
Â  Â  .info {
Â  Â  Â  background: #e7f3ff;
Â  Â  Â  padding: 10px;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  font-size: 13px;
Â  Â  Â  color: #0066cc;
Â  Â  }
Â  Â  .loading {
Â  Â  Â  text-align: center;
Â  Â  Â  color: #666;
Â  Â  }
Â  Â  .spinner {
Â  Â  Â  border: 3px solid #f3f3f3;
Â  Â  Â  border-top: 3px solid #007bff;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  width: 40px;
Â  Â  Â  height: 40px;
Â  Â  Â  animation: spin 1s linear infinite;
Â  Â  Â  margin: 20px auto;
Â  Â  }
Â  Â  @keyframes spin {
Â  Â  Â  0% { transform: rotate(0deg); }
Â  Â  Â  100% { transform: rotate(360deg); }
Â  Â  }
Â  </style>
</head>
<body>
Â  <div class="container">
Â  Â  <h1>âš¡ TranscripciÃ³n de Audio con Faster-Whisper</h1>
Â  Â Â 
Â  Â  <div class="info">
Â  Â  Â  ğŸ’¡ <strong>Tip:</strong> Usando <strong>Faster-Whisper</strong>, la transcripciÃ³n es mucho mÃ¡s rÃ¡pida que el Whisper original. Tienes acceso a los modelos **v2** y **v3**.
Â  Â  </div>

Â  Â  <div class="form-group">
Â  Â  Â  <label for="audioFile">ğŸ“ Selecciona un archivo de audio:</label>
Â  Â  Â  <input type="file" id="audioFile" accept="audio/*,video/*">
Â  Â  </div>

Â  Â  <div class="form-group">
Â  Â  Â  <label for="modelo">ğŸ¤– Modelo de Whisper:</label>
Â  Â  Â  <select id="modelo">
Â  Â  Â  Â  <option value="tiny">Tiny (MÃ¡s rÃ¡pido âš¡âš¡âš¡âš¡âš¡)</option>
Â  Â  Â  Â  <option value="base" selected>Base (Equilibrado âš¡âš¡âš¡âš¡)</option>
Â  Â  Â  Â  <option value="small">Small (MÃ¡s preciso âš¡âš¡âš¡)</option>
Â  Â  Â  Â  <option value="medium">Medium (Muy preciso âš¡âš¡)</option>
        Â  Â  Â  Â  <option value="large">Large (PrecisiÃ³n: v1)</option>
Â  Â  Â  Â  <option value="large-v2">Large v2 (MÃ¡xima precisiÃ³n âš¡)</option>
Â  Â  Â  Â  <option value="large-v3">Large v3 (Mejor precisiÃ³n en nuevos idiomas)</option>
        Â  Â  Â  </select>
Â  Â  </div>

Â  Â  <div class="form-group">
Â  Â  Â  <label for="language">ğŸŒ Idioma:</label>
Â  Â  Â  <select id="language">
Â  Â  Â  Â  <option value="">Auto-detectar</option>
Â  Â  Â  Â  <option value="es" selected>EspaÃ±ol</option>
Â  Â  Â  Â  <option value="en">InglÃ©s</option>
Â  Â  Â  Â  <option value="fr">FrancÃ©s</option>
Â  Â  Â  Â  <option value="de">AlemÃ¡n</option>
Â  Â  Â  Â  <option value="it">Italiano</option>
Â  Â  Â  Â  <option value="pt">PortuguÃ©s</option>
Â  Â  Â  Â  <option value="zh">Chino</option>
Â  Â  Â  Â  <option value="ja">JaponÃ©s</option>
Â  Â  Â  Â  <option value="ko">Coreano</option>
Â  Â  Â  </select>
Â  Â  </div>

Â  Â  <div class="form-group">
Â  Â  Â  <label for="formato">ğŸ“„ Formato de salida:</label>
Â  Â  Â  <select id="formato">
Â  Â  Â  Â  <option value="json">JSON (Ver en pantalla)</option>
Â  Â  Â  Â  <option value="txt">TXT (Descargar)</option>
Â  Â  Â  Â  <option value="docx">Word/DOCX (Descargar)</option>
Â  Â  Â  Â  <option value="pdf">PDF (Descargar)</option>
Â  Â  Â  </select>
Â  Â  </div>

Â  Â  <button id="btnEnviar">Transcribir Audio</button>
Â  Â Â 
Â  Â  <div id="resultado"></div>
Â  </div>

Â  <script>
Â  Â  // --- CAMBIO CRÃTICO: La URL del API ---
    // Si tu Space se llama "mi-usuario/mi-app", la URL debe ser:
    // https://mi-usuario-mi-app.hf.space/transcribe
    // O si lo sirves con FastAPI desde el mismo contenedor (mejor prÃ¡ctica), usa la ruta relativa: "/transcribe"
Â  Â  const API_URL = "/transcribe"; // Usar ruta relativa para Hugging Face Space

Â  Â  document.getElementById('btnEnviar').addEventListener('click', async () => {
Â  Â  Â  const fileInput = document.getElementById('audioFile');
Â  Â  Â  const modeloSelect = document.getElementById('modelo');
Â  Â  Â  const languageSelect = document.getElementById('language');
Â  Â  Â  const formatoSelect = document.getElementById('formato');
Â  Â  Â  const btnEnviar = document.getElementById('btnEnviar');
Â  Â  Â  const resultado = document.getElementById('resultado');

Â  Â  Â  const file = fileInput.files[0];
Â  Â  Â  const modelo = modeloSelect.value;
Â  Â  Â  const language = languageSelect.value;
Â  Â  Â  const formato = formatoSelect.value;

Â  Â  Â  if (!file) {
Â  Â  Â  Â  alert('Por favor, selecciona un archivo de audio primero.');
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Deshabilitar botÃ³n
Â  Â  Â  btnEnviar.disabled = true;
Â  Â  Â  btnEnviar.textContent = "Procesando...";
Â  Â  Â Â 
Â  Â  Â  resultado.classList.add('show');
Â  Â  Â  resultado.innerHTML = `
Â  Â  Â  Â  <div class="loading">
Â  Â  Â  Â  Â  <div class="spinner"></div>
Â  Â  Â  Â  Â  <p>â³ Transcribiendo con modelo <strong>${modelo}</strong> (Faster-Whisper)...</p>
Â  Â  Â  Â  Â  <p style="font-size: 12px;">Esto puede tomar desde unos segundos hasta algunos minutos dependiendo del modelo y tamaÃ±o del archivo.</p>
Â  Â  Â  Â  </div>
Â  Â  Â  `;

Â  Â  Â  const formData = new FormData();
Â  Â  Â  formData.append("file", file);
Â  Â  Â  formData.append("modelo", modelo);
Â  Â  Â  formData.append("formato", formato);
Â  Â  Â  // Si el valor es una cadena vacÃ­a (Auto-detectar), no la anexamos para que el backend use None.
Â  Â  Â  if (language) { 
Â  Â  Â  Â  formData.append("language", language);
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  try {
Â  Â  Â  Â  const response = await fetch(API_URL, {
Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  body: formData
Â  Â  Â  Â  });

Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  const errorResponse = await response.json().catch(() => ({ error: 'Error desconocido del servidor.' }));
Â  Â  Â  Â  Â  throw new Error(`Error ${response.status}: ${errorResponse.error || response.statusText}`);
Â  Â  Â  Â  }

Â  Â  Â  Â  // Si es JSON, mostrar en pantalla
Â  Â  Â  Â  if (formato === "json") {
Â  Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  Â  console.log(result);

Â  Â  Â  Â  Â  if (result.success) {
Â  Â  Â  Â  Â  Â  // Mostramos el texto mejorado, pero si no hay mejora, mostramos el original
Â  Â  Â  Â  Â  Â  const displayText = result.texto_mejorado || result.text || result.texto_original;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  resultado.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  <strong>âœ… TranscripciÃ³n completada</strong><br>
              <div class="info" style="margin-top: 10px;">
                <strong>Modelo Whisper:</strong> ${result.modelo_whisper}<br>
                <strong>Idioma detectado:</strong> ${result.language}<br>
                <strong>Mejora Llama:</strong> ${result.tipo_mejora === "ninguna" ? "No aplicada" : result.tipo_mejora}
              </div>
Â  Â  Â  Â  Â  Â  Â  <strong>Texto Final:</strong><br>
Â  Â  Â  Â  Â  Â  Â  <div style="background: white; padding: 15px; border-radius: 5px; margin-top: 10px; border: 1px solid #ddd;">
Â  Â  Â  Â  Â  Â  Â  Â  ${displayText}
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  resultado.innerHTML = `âŒ Error en el servidor: ${result.error}`;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  // Si es archivo descargable (txt, docx, pdf)
Â  Â  Â  Â  Â  const blob = await response.blob();
Â  Â  Â  Â  Â  const url = window.URL.createObjectURL(blob);
Â  Â  Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  Â  Â  a.href = url;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // La API debe devolver el nombre de archivo correcto en el Content-Disposition header.
          // Por seguridad, usamos una extensiÃ³n por defecto si el servidor no la proporciona.
Â  Â  Â  Â  Â  const defaultExtension = formato === "docx" ? "docx" : formato === "pdf" ? "pdf" : "txt";
          const contentDisposition = response.headers.get('Content-Disposition');
          let fileName = `transcripcion_${Date.now()}.${defaultExtension}`;
          
          if (contentDisposition) {
              const fileNameMatch = contentDisposition.match(/filename="(.+)"/i);
              if (fileNameMatch.length === 2) {
                  fileName = fileNameMatch[1];
              }
          }
          a.download = fileName;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  document.body.appendChild(a);
Â  Â  Â  Â  Â  a.click();
Â  Â  Â  Â  Â  document.body.removeChild(a);
Â  Â  Â  Â  Â  window.URL.revokeObjectURL(url);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  resultado.innerHTML = `âœ… <strong>Archivo de ${formato.toUpperCase()} descargado exitosamente!</strong><br><br>El nombre de archivo es: <strong>${fileName}</strong>. Revisa tu carpeta de descargas.`;
Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error(error);
Â  Â  Â  Â  resultado.innerHTML = `âŒ <strong>Error:</strong> ${error.message}`;
Â  Â  Â  } finally {
Â  Â  Â  Â  // Rehabilitar botÃ³n
Â  Â  Â  Â  btnEnviar.disabled = false;
Â  Â  Â  Â  btnEnviar.textContent = "Transcribir Audio";
Â  Â  Â  }
Â  Â  });
Â  </script>
</body>
</html>
